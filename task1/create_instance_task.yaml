---
- name: create instance , create image, copy image, launch machine on image
  hosts: localhost
  gather_facts: true
  vars_files: task1_vars
  tasks:
    - name: Create intance for You
      ec2:
        name: "{{name}}"
        instance_type: "{{instance_type}}"
        image: "{{image}}"
        count: "{{count}}"
        vpc_subnet_id: "{{vpc_subnet_id}}"
        region: "{{region}}"
    
    - name: create authorized_key file
      file:
        path: "/home/centos/.ssh/authorized_keys"
        mode: 0600
        state: touch
        owner: "centos"

    - name: add public key
      lineinfile:
        path: "/home/centos/.ssh/authorized_keys"
        line: "{{line}}"     

    - name: Create image for you
      ec2_instance_facts:
        filters:
          tag: "{{name}}"
          instance_ids:
